!------------Physical costants-------------------------------                   
  E0    := 0.938272310   !proton mass [GeV]                                     
  C     := 2.99792458e8  !speed of light [m/sec]                                
  PI    := 3.141592654                                                          

  DTR   := PI/180.                                                              
  EK    := 1.60                                                                 
  EINJ  := 0.08          ![GeV] injection kinetic Energy                        
  PC    := sqrt(EK*(EK+2*E0))       ;  Value PC                                 
  PCI   := sqrt(EINJ*(EINJ+2*E0))   ;  Value PCI                                
  BRHO  := 1.e9*PC/C                ;  Value BRHO                               
  BRHOINJ :=1.e9*PCI/C              ;  Value BRHOINJ                             
  GAMMA := 1+EK/E0                  ;  Value GAMMA                              
  BETA  := sqrt(1-1/(GAMMA*GAMMA))  ;  Value BETA                               
!                                                                               
  ANG:= 2*PI/24                                                                 
  EE := ANG/2                                                                   
  LBEND := 2.1                                                                
  RHOB:=LBEND/ANG                                                               
  BBND:=BRHO/RHOB 
!                                                                                                                                     
R1MB01: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R1MB02: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R1MB03: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R1MB04: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R1MB05: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R1MB06: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
!
R2MB01: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R2MB02: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R2MB03: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R2MB04: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R2MB05: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R2MB06: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
!
R3MB01: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R3MB02: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R3MB03: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R3MB04: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R3MB05: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R3MB06: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
!
R4MB01: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R4MB02: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R4MB03: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R4MB04: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R4MB05: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
R4MB06: SBEND, L=LBEND, ANGLE=ANG, E1=EE,E2=EE
!
R1Q01:  Quad,  L=0.41,  K1=KQ01/Brho                                         
R1Q02:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R1Q03:  Quad,  L=0.41,  K1=KQ03/Brho                                         
R1Q04:  Quad,  L=0.45,  K1=KQ04/Brho                                         
R1Q05:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R1Q06:  Quad,  L=0.62,  K1=KQ06/Brho
R1Q07:  Quad,  L=0.41,  K1=KQ01/Brho                                         
R1Q08:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R1Q09:  Quad,  L=0.41,  K1=KQ03/Brho                                         
R1Q10:  Quad,  L=0.45,  K1=KQ04/Brho                                         
R1Q11:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R1Q12:  Quad,  L=0.62,  K1=KQ06/Brho  
!
R2Q01:  Quad,  L=0.41,  K1=KQ01/Brho                                         
R2Q02:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R2Q03:  Quad,  L=0.41,  K1=KQ03/Brho                                         
R2Q04:  Quad,  L=0.45,  K1=KQ04/Brho                                         
R2Q05:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R2Q06:  Quad,  L=0.62,  K1=KQ06/Brho
R2Q07:  Quad,  L=0.41,  K1=KQ01/Brho                                         
R2Q08:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R2Q09:  Quad,  L=0.41,  K1=KQ03/Brho                                         
R2Q10:  Quad,  L=0.45,  K1=KQ04/Brho                                         
R2Q11:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R2Q12:  Quad,  L=0.62,  K1=KQ06/Brho  
!
R3Q01:  Quad,  L=0.41,  K1=KQ01/Brho                                         
R3Q02:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R3Q03:  Quad,  L=0.41,  K1=KQ03/Brho                                         
R3Q04:  Quad,  L=0.45,  K1=KQ04/Brho                                         
R3Q05:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R3Q06:  Quad,  L=0.62,  K1=KQ06/Brho
R3Q07:  Quad,  L=0.41,  K1=KQ01/Brho                                         
R3Q08:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R3Q09:  Quad,  L=0.41,  K1=KQ03/Brho                                         
R3Q10:  Quad,  L=0.45,  K1=KQ04/Brho                                         
R3Q11:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R3Q12:  Quad,  L=0.62,  K1=KQ06/Brho  
!
R4Q01:  Quad,  L=0.41,  K1=KQ01/Brho                                         
R4Q02:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R4Q03:  Quad,  L=0.41,  K1=KQ03/Brho                                         
R4Q04:  Quad,  L=0.45,  K1=KQ04/Brho                                         
R4Q05:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R4Q06:  Quad,  L=0.62,  K1=KQ06/Brho
R4Q07:  Quad,  L=0.41,  K1=KQ01/Brho                                         
R4Q08:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R4Q09:  Quad,  L=0.41,  K1=KQ03/Brho                                         
R4Q10:  Quad,  L=0.45,  K1=KQ04/Brho                                         
R4Q11:  Quad,  L=0.9,  K1=KQ02/Brho                                         
R4Q12:  Quad,  L=0.62,  K1=KQ06/Brho  
!
R1SD01:  SEXTUPOLE, L = 0.2, K2=0 
R1SF02:  SEXTUPOLE, L = 0.2, K2=0 
R1SD03:  SEXTUPOLE, L = 0.2, K2=0
R1SF04:  SEXTUPOLE, L = 0.2, K2=0       
!                                                                                  
LQE:  DRIFT, L=0.15
LBE1: DRIFT, L=0.20
LBE2: DRIFT, L=0.15
!
LL0=5.5
LL011=0.8
LL021=1.15
LL031=3.8
LL032=1.2
LL033=0.8
LL034=0.5
LL041=1.3
LL051=0.8
LL061=0.9
LL062=1.75
L0:    DRIFT, L=5.35
L01:   DRIFT, L=5.0
L011:  DRIFT, L=0.5
L021:  DRIFT, L=0.85                                                             
L031:  DRIFT, L=3.3                                                                  
L032:  DRIFT, L=0.5
L033:  DRIFT, L=0.45
L034:  DRIFT, L=0.15
L041:  DRIFT, L=0.8
L051:  DRIFT, L=0.5
L061:  DRIFT, L=0.4
L062:  DRIFT, L=1.4   

LLL062:  DRIFT, L=1.375 
LCP01: DRIFT, L=0.00001-0.0000087
LCP02: DRIFT, L=0.0005-0.00045
LCP03: DRIFT, L=0.1-0.07 
LLL063:  DRIFT, L=1.32449+0.00045+0.0000087+0.07
LCP04: DRIFT, L=0.1-0.07
LLL064: DRIFT, L=0.1
LLL065: DRIFT, L=0.5+0.07

                     
R11: LINE= (L0,LQE,R1Q01,LQE,L011,LQE,R1Q02,LQE,L021,LQE,&
           R1Q03,LQE,L031,LBE2,LBE1,R1MB01,LBE1,LBE2,L032,&
           LBE2,LBE1,R1MB02,LBE1,LBE2,R1SF02,L033,L034,LQE,R1Q04,LQE,&
           L041,R1SD01,LQE,&                
           R1Q05,LQE,L051,LQE,R1Q06,LQE,L061,LBE2,LBE1, &
           R1MB03,LBE1,LBE2,LLL062,LCP01,LCP02,LCP03)
R12: LINE= (L01,L011,R1Q07,LQE,L011,LQE,R1Q08,LQE,L021,LQE,&
           R1Q09,LQE,L031,LBE2,LBE1,R1MB04,LBE1,LBE2,LLL065,&
           LLL064,LCP04,LBE2,R1MB05,LBE1,LBE2,R1SF04,L033,L034,LQE,R1Q10,LQE,&
           L041,R1SD03,LQE,&  
           R1Q11,LQE,L051,LQE,R1Q12,LQE,L061,LBE2,LBE1, &
           R1MB06,LBE1,LBE2,LLL063)
R21: LINE= (L0,LQE,R2Q01,LQE,L011,LQE,R2Q02,LQE,L021,LQE,&
           R2Q03,LQE,L031,LBE2,LBE1,R2MB01,LBE1,LBE2,L032,&
           LBE2,LBE1,R2MB02,LBE1,LBE2,L033,L034,R1SF02,LQE,R2Q04,LQE,&
           R1SD01,L041,LQE,&
           R2Q05,LQE,L051,LQE,R2Q06,LQE,L061,LBE2,LBE1, &
           R2MB03,LBE1,LBE2,L062)
R22: LINE= (L0,LQE,R2Q07,LQE,L011,LQE,R2Q08,LQE,L021,LQE,&
           R2Q09,LQE,L031,LBE2,LBE1,R2MB04,LBE1,LBE2,L032,&
           LBE2,LBE1,R2MB05,LBE1,LBE2,L033,L034,R1SF04,LQE,R2Q10,LQE,&
           R1SD03,L041,LQE,&
           R2Q11,LQE,L051,LQE,R2Q12,LQE,L061,LBE2,LBE1, &
           R2MB06,LBE1,LBE2,L062)
R31: LINE= (L0,LQE,R3Q01,LQE,L011,LQE,R3Q02,LQE,L021,LQE,&
           R3Q03,LQE,L031,LBE2,LBE1,R3MB01,LBE1,LBE2,L032,&
           LBE2,LBE1,R3MB02,LBE1,LBE2,L033,L034,R1SF02,LQE,R3Q04,LQE,&
           R1SD01,L041,LQE,&
           R3Q05,LQE,L051,LQE,R3Q06,LQE,L061,LBE2,LBE1, &
           R3MB03,LBE1,LBE2,L062)
R32: LINE= (L0,LQE,R3Q07,LQE,L011,LQE,R3Q08,LQE,L021,LQE,&
           R3Q09,LQE,L031,LBE2,LBE1,R3MB04,LBE1,LBE2,L032,&
           LBE2,LBE1,R3MB05,LBE1,LBE2,L033,L034,R1SF04,LQE,R3Q10,LQE,&
           R1SD03,L041,LQE,&
           R3Q11,LQE,L051,LQE,R3Q12,LQE,L061,LBE2,LBE1, &
           R3MB06,LBE1,LBE2,L062)
R41: LINE= (L0,LQE,R4Q01,LQE,L011,LQE,R4Q02,LQE,L021,LQE,&
           R4Q03,LQE,L031,LBE2,LBE1,R4MB01,LBE1,LBE2,L032,&
           LBE2,LBE1,R4MB02,LBE1,LBE2,L033,L034,R1SF02,LQE,R4Q04,LQE,&
           R1SD01,L041,LQE,&
           R4Q05,LQE,L051,LQE,R4Q06,LQE,L061,LBE2,LBE1, &
           R4MB03,LBE1,LBE2,L062)
R42: LINE= (L0,LQE,R4Q07,LQE,L011,LQE,R4Q08,LQE,L021,LQE,&
           R4Q09,LQE,L031,LBE2,LBE1,R4MB04,LBE1,LBE2,L032,&
           LBE2,LBE1,R4MB05,LBE1,LBE2,L033,L034,R1SF04,LQE,R4Q10,LQE,&
           R1SD03,L041,LQE,&
           R4Q11,LQE,L051,LQE,R4Q12,LQE,L061,LBE2,LBE1, &
           R4MB06,LBE1,LBE2,L062)
!------------------------------------------------------------                   
!
 KQ06= 4.786782E+00
 KQ04= 4.488622E+00
 KQ03= 5.225282E+00
 KQ02=-4.557900E+00
 KQ01= 5.826800E+00
!
R1: LINE= (R11,-R12)
R2: LINE= (R21,-R22)
R3: LINE= (R31,-R32)
R4: LINE= (R41,-R42)
RCS: LINE= (R1,R2,R3,R4)
USE, RCS
!
print, full
!SELECT, FIRST, RANGE=#S/#E
twiss, save,TAPE="CSNS1124.TW"

!Select, optics, full
!optics, file = "CSNS1124.TXT" , &
!col=name, keyw, L, tilt, k0l, e1, e2, k1l, k2l, k3l, ks
!PLOT, HAXIS=s, VAXIS1=BETX, BETY, VAXIS2=Dx, COLOUR=100
stop                                                                                                                                                   
